<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SzybkieSpanko/Warszawa.pl</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://kit.fontawesome.com/4777a01fa8.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <h1>SzybkieSpanko.pl</h1>
        </div>
        <div class="nav-right">
            <a class="nav-link" href="#">
                <h3>Kontakt</h3>
            </a>
            <a class="nav-link" href="#">
                <h3>Polityka prywatności</h3>
            </a>
            <button class="nav-button">Zaloguj się</button>
            <button class="nav-button">Zarejestruj się</button>
        </div>
    </nav>
    <div class="main-container">
        <div class="form-container">
            <form>
                <div class="input-container">
                    <i class="fa-solid fa-bed"></i>
                    <input id="townDropdownInput" type="text" placeholder="Dokąd się wybierasz?" onkeyup="town_search()">
                    <div id="townDropdownContainer" class="town-dropdown-container">
                        <ul id="list">
                            <li class="city">Warszawa</li>
                            <li class="city">Gdańsk</li>
                            <li class="city">Kraków</li>
                            <li class="city">Łódź</li>
                            <li class="city">Szczecin</li>
                            <li class="city">Poznań</li>
                            <li class="city">Wrocław</li>
                            <li class="city">Słupsk</li>
                        </ul>
                    </div>
                </div>
                <div class="input-container">
                    <i class="fa-regular fa-calendar"></i>
                    <input id="dateRange" class="flatpickr flatpickr-input active" type="text" placeholder="Zameldowanie - wymeldowanie" data-id="rangePreload" readonly="readonly">
                </div>
                <div class="guest-selector">
                    <button class="guest-select-button" id="guestButton" type="button">Wybierz liczbę gości</button>
                    <div class="guest-selector-container" id="guestSelectorContainer">
                        <div class="person-selector-container">
                            <label>Dorośli:</label>
                            <div class="counter-container">
                                <button class="" type="button" id="adults-minus">-</button>
                                <span id="adults">1</span>
                                <button type="button" id="adults-plus">+</button>
                            </div>
                        </div>
                        <div class="person-selector-container">
                            <label>Dzieci:</label>
                            <div class="counter-container">
                                <button type="button" id="children-minus">-</button>
                                <span id="children">0</span>
                                <button type="button" id="children-plus">+</button>
                            </div>
                        </div>
                        <button type="button" id="readyButton" class="ready-button">Gotowe</button>
                    </div>
                </div>
                <button type="button" id="searchButton" class="search-button">Szukaj</button>
            </form>
        </div>
        <div class="results-container">
            <div class="listing-container-left">
                <div class="map-container" id="map"></div>
            </div>
            <div class="listing-container-right">
                <div class="listing-container-top">
                    <h2><span id="city-name"></span> znaleziono <span id="property-count"></span> obiektów</h2>
                    <div class="input-container">
                        <i class="fa-solid fa-arrows-up-down"></i>
                        <button class="filter-button">Sortuj według: Najpopularniejsze</button>
                    </div>
                </div>
                <div class="listing-container-main" id="listing-container">
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <script src="app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Pobierz parametry z URL
            const urlParams = new URLSearchParams(window.location.search);
            const city = urlParams.get("city");

            if (!city) {
        console.error("Brak parametru city w URL!");
        return;
    }

    console.log("Miasto:", city);

    fetch(`/results?city=${city}`)
        .then(response => {
            console.log("Odpowiedź serwera:", response);
            return response.json();
        })
        .then(data => {
            console.log("Dane z serwera:", data);
        })
        .catch(error => {
            console.error("Błąd podczas ładowania danych:", error);
        });
    
            // Wyświetl nazwę miasta na stronie
            document.getElementById("city-name").textContent = city;
    
            // Pobierz dane z serwera
            fetch(`/results?city=${city}`)
                .then(response => response.json())
                .then(data => {
                    const results = data.results;
                    const listingContainer = document.getElementById("listing-container");
    
                    // Wyświetl liczbę znalezionych obiektów
                    document.getElementById("property-count").textContent = results.length;
    
                    // Iteracja po wynikach i tworzenie elementów HTML
                    results.forEach(result => {
                        const listing = document.createElement("div");
                        listing.classList.add("listing");
    
                        listing.innerHTML = `
                            <div class="listing-img-container">
                                <img alt="${result.object_name}" src="${result.imageUrl}">
                            </div>
                            <div class="listing-details-container">
                                <div class="listing-details-top">
                                    <h4>${result.object_name}</h4>
                                    <div class="location-details-container">
                                        <p>${result.address}</p>
                                        <p>Pokaż na mapie</p>
                                        <p>${result.distance} km od centrum</p>
                                    </div>
                                    <div class="distinct-attributes-container">
                                        <p class="popup">${result.attribute1}
                                            <span class="tooltip-text">
                                                <span class="bold">${result.attribute1}<br></span>
                                                ${result.attribute1_description}
                                            </span>
                                        </p>
                                        <p class="popup">${result.attribute2}
                                            <span class="tooltip-text">
                                                <span class="bold">${result.attribute2}<br></span>
                                                ${result.attribute2_description}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div class="listing-details-bottom">
                                    <div class="listing-details-bottom-left">
                                        <h5>${result.roomDetails}</h5>
                                        <p>${result.roomDetailsDescription}</p>
                                        <h5><span class="urgent">${result.urgent}</span></h5>
                                    </div>
                                </div>
                            </div>
                        `;
    
                        listingContainer.appendChild(listing);
                    });
                })
                .catch(error => {
                    console.error("Błąd podczas ładowania danych:", error);
                });
        });
    </script>        
</body>
</html>